function init(){var t=new Jeu;t.init()}var Canvas=function(){function t(t){this.element=t}return t.prototype.init=function(){if(!this.element||!this.element.getContext)throw new Error("Le canvas n'est pas pris en charge par votre navigateur");if(this.context=this.element.getContext("2d"),!this.context)throw new Error("Le canvas n'est pas pris en charge par votre navigateur");return this},t.prototype.getContext=function(){return this.context},t.prototype.getElement=function(){return this.element},t}(),Case=function(){function t(){this.wall=!1,this.coordinates={x:0,y:0},this.borderLeft=!0,this.borderRight=!0,this.borderTop=!0,this.borderBottom=!0}return t.prototype.isAWall=function(t){return void 0===t&&(t=null),null!==t&&(this.wall=t),this.wall},t.prototype.hasBorderLeft=function(t){return void 0===t&&(t=null),null!==t&&(this.borderLeft=t),this.borderLeft},t.prototype.hasBorderRight=function(t){return void 0===t&&(t=null),null!==t&&(this.borderRight=t),this.borderRight},t.prototype.hasBorderTop=function(t){return void 0===t&&(t=null),null!==t&&(this.borderTop=t),this.borderTop},t.prototype.hasBorderBottom=function(t){return void 0===t&&(t=null),null!==t&&(this.borderBottom=t),this.borderBottom},t.prototype.setCoordinates=function(t,e){this.coordinates.x=t,this.coordinates.y=e},t.prototype.getCoordinates=function(){return this.coordinates},t.CASE_WIDTH=40,t}(),Directions;!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Up=2]="Up",t[t.Down=3]="Down"}(Directions||(Directions={}));var Jeu=function(){function t(){this.time=+new Date}return t.prototype.init=function(){try{this.canvas=new Canvas(document.querySelector("canvas")),this.canvas.init()}catch(t){return alert(t.message),window.location.href="http://www.thomas-hiron.com",this}return this.levelsManager=new LevelsManager,this.levelsManager.draw(this.canvas),this.pacman=new Pacman,this.pacman.setCollideFunction(this.checkCollision.bind(this)),this.pacman.init(),this.pacman.start(),requestAnimFrame(this.draw.bind(this)),this},t.prototype.draw=function(){if(+new Date-this.time>t.INTERVAL){var e=this.pacman,i=(Case.CASE_WIDTH-e.getSize().w)/2;this.canvas.getContext().clearRect(e.getX()+i,e.getY()+i,e.getSize().w,e.getSize().h),e.draw(this.canvas.getContext()),this.time=+new Date}return requestAnimFrame(this.draw.bind(this)),this},t.prototype.checkCollision=function(t,e){var i=this.levelsManager.getCurrentCasesLevel();return void 0==i[e]||void 0===i[e][t]||i[e][t].isAWall()},t.INTERVAL=10,t}(),Levels=function(){function t(){this.levels=[],this.constructLevel1()}return t.prototype.constructLevel1=function(){for(var t=new Array(20),e=0,i=t.length;e<i;++e){t[e]=new Array(15);for(var n=0,r=t[e].length;n<r;++n)t[e][n]=new Case,t[e][n].setCoordinates(n,e)}var s=[[0,7],[1,1],[1,2],[1,4],[1,5],[1,7],[1,9],[1,10],[1,12],[1,13],[3,1],[3,2],[3,3],[3,4],[3,5],[3,7],[3,9],[3,10],[3,11],[3,12],[3,13],[4,5],[4,7],[4,9],[5,1],[5,3],[5,5],[5,7],[5,9],[5,11],[5,13],[6,1],[6,13],[7,1],[7,2],[7,3],[7,4],[7,5],[7,7],[7,9],[7,10],[7,11],[7,12],[7,13],[9,0],[9,1],[9,2],[9,3],[9,11],[9,12],[9,13],[9,14],[11,0],[11,1],[11,2],[11,3],[11,11],[11,12],[11,13],[11,14],[12,3],[12,5],[12,6],[12,7],[12,8],[12,9],[12,11],[13,1],[13,3],[13,7],[13,11],[13,13],[14,3],[14,5],[14,7],[14,9],[14,11],[15,1],[15,5],[15,9],[15,13],[16,1],[16,2],[16,3],[16,4],[16,5],[16,7],[16,9],[16,10],[16,11],[16,12],[16,13],[17,7],[18,1],[18,2],[18,3],[18,4],[18,5],[18,6],[18,7],[18,8],[18,9],[18,10],[18,11],[18,12],[18,13]];for(e=0,i=s.length;e<i;++e)t[s[e][0]][s[e][1]].isAWall(!0);return this.levels.push(t),this},t.prototype.get=function(t){var e=this.levels[t-1]||null;return e},t}(),LevelsManager=function(){function t(){this.currentLevel=1,this.levels=new Levels}return t.prototype.draw=function(t){var e=this.levels.get(this.currentLevel);if(null==e)return this;for(var i=0,n=e.length;i<n;++i)for(var r=e[i],s=0,o=r.length;s<o;++s){var a=r[s],h=r[s-1]||null,c=r[s+1]||null,l=null!=e[i-1]?e[i-1][s]:null,u=null!=e[i+1]?e[i+1][s]:null;a.hasBorderLeft(null!=h&&a.isAWall()&&!h.isAWall()),a.hasBorderRight(null!=c&&a.isAWall()&&!c.isAWall()),a.hasBorderTop(null!=l&&a.isAWall()&&!l.isAWall()),a.hasBorderBottom(null!=u&&a.isAWall()&&!u.isAWall()),this.drawCase(t,a)}return this},t.prototype.drawCase=function(t,e){var i=t.getContext();i.strokeStyle="#012EB6",i.lineWidth=4;var n=e.getCoordinates();return e.hasBorderLeft()&&(i.moveTo(n.x*Case.CASE_WIDTH,n.y*Case.CASE_WIDTH),i.lineTo(n.x*Case.CASE_WIDTH,(n.y+1)*Case.CASE_WIDTH)),e.hasBorderRight()&&(i.moveTo((n.x+1)*Case.CASE_WIDTH,n.y*Case.CASE_WIDTH),i.lineTo((n.x+1)*Case.CASE_WIDTH,(n.y+1)*Case.CASE_WIDTH)),e.hasBorderTop()&&(i.moveTo(n.x*Case.CASE_WIDTH,n.y*Case.CASE_WIDTH),i.lineTo((n.x+1)*Case.CASE_WIDTH,n.y*Case.CASE_WIDTH)),e.hasBorderBottom()&&(i.moveTo(n.x*Case.CASE_WIDTH,(n.y+1)*Case.CASE_WIDTH),i.lineTo((n.x+1)*Case.CASE_WIDTH,(n.y+1)*Case.CASE_WIDTH)),i.stroke(),i.globalCompositeOperation="destination-out",i.lineWidth=2,i.stroke(),i.globalCompositeOperation="source-over",i.closePath(),this},t.prototype.getCurrentCasesLevel=function(){return this.levels.get(this.currentLevel)},t}();window.addEventListener("load",init,!1);var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60,(new Date).getTime())}}(),Pacman=function(){function t(){this.size={w:24,h:24},this.coordinates={x:7*Case.CASE_WIDTH,y:11*Case.CASE_WIDTH},this.currentStep=0,this.stepNumber=6,this.interval=40,this.stepPx=2,this.time=+new Date}return t.prototype.setCollideFunction=function(t){return this.checkCollision=t,this},t.prototype.getSize=function(){return this.size},t.prototype.getX=function(){return this.coordinates.x},t.prototype.getY=function(){return this.coordinates.y},t.prototype.init=function(){this.canvas=new Canvas(document.createElement("CANVAS")),this.canvas.init();var t=this.canvas.getElement();return t.width=this.size.w,t.height=this.size.h,this.direction=1,this.nextDirection=this.direction,window.addEventListener("keydown",this.rotate.bind(this),!1),this},t.prototype.rotate=function(t){t.preventDefault();var e=t.keyCode;switch(e){case 37:this.nextDirection=0;break;case 38:this.nextDirection=2;break;case 39:this.nextDirection=1;break;case 40:this.nextDirection=3}return this},t.prototype.start=function(){return requestAnimFrame(this.animate.bind(this)),this},t.prototype.animate=function(){return+new Date-this.time>this.interval&&(this.currentStep++,this.currentStep%this.stepNumber==0&&(this.currentStep=0),this.time=+new Date),requestAnimFrame(this.animate.bind(this)),this},t.prototype.draw=function(t){var e=0,i=this.canvas.getContext(),n=this.size,r=Case.CASE_WIDTH,s=!1,o=!1,a=this.coordinates.x,h=this.coordinates.y;if(this.coordinates.x%r==0&&this.coordinates.y%r==0){var c=this.getNextCaseCoords(this.nextDirection),l=this.getNextCaseCoords(this.direction);s=this.checkCollision(c.x,c.y),o=this.checkCollision(l.x,l.y),s||(this.direction=this.nextDirection)}else(0==this.direction&&1==this.nextDirection||1==this.direction&&0==this.nextDirection||2==this.direction&&3==this.nextDirection||3==this.direction&&2==this.nextDirection)&&(this.direction=this.nextDirection);switch(this.direction){case 0:a-=this.stepPx,e=180;break;case 1:a+=this.stepPx,e=0;break;case 2:h-=this.stepPx,e=270;break;case 3:h+=this.stepPx,e=90}s&&o||(this.coordinates.x=a,this.coordinates.y=h),i.clearRect(0,0,n.w,n.h),i.save(),i.translate(n.w/2,n.h/2),i.rotate(e*Math.PI/180),i.translate(-n.w/2,-n.h/2),i.fillStyle="#FFFF00";var u=.25*this.currentStep/(this.stepNumber-1),d=1-u;i.beginPath(),i.arc(n.w/2,n.h/2,n.w/2,u*Math.PI,(u+1)*Math.PI,!1),i.fill(),i.beginPath(),i.arc(n.w/2,n.h/2,n.w/2,d*Math.PI,(d+1)*Math.PI,!1),i.fill();var p=(r-n.w)/2;return t.drawImage(i.canvas,this.getX()+p,this.getY()+p),i.restore(),this},t.prototype.getNextCaseCoords=function(t){var e={x:this.coordinates.x/Case.CASE_WIDTH,y:this.coordinates.y/Case.CASE_WIDTH};switch(t){case 0:e.x--;break;case 1:e.x++;break;case 2:e.y--;break;case 3:e.y++}return e},t}();